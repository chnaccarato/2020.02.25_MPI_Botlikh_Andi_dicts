---
title: "Comparing phonological systems and syllable structure of Botlikh and Zilo Andi: a data--driven analysis"
author: "G. Moroz"
institute: "Linguistic Convergence Laboratory, HSE University, Moscow, Russia"
date: |
    | 25 February 2020, MPI-SHH, Jena
    | 
    | Presentation is available here: \alert{tinyurl.com/rvpqdaa}
    |
    | ![](images/01_qrcode.png)'
output: 
  beamer_presentation:
    df_print: kable
    latex_engine: xelatex
    citation_package: natbib
    includes:
      in_header: "config/presento.sty"
classoption: t
bibliography: bibliography.bib
biblio-style: "apalike"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, dev='cairo_pdf', comment=NA)
# setwd("/home/agricolamz/work/materials/2020.02.25_MPI_Botlikh_Andi_dicts/new/")
library(tidyverse)
library(tidytext)
library(extrafont)
loadfonts()
theme_set(theme_bw()+
            theme(text = element_text(size = 19, family = "Brill")))
library(qrcode)
png(filename="images/01_qrcode.png", width = 200, height = 200)
qrcode_gen("https://github.com/agricolamz/2020.02.25_MPI_Botlikh_Andi_dicts/raw/master/2020.02.25_MPI_Botlikh_Andi_dicts.pdf")
dev.off()

stress <- "́"
```

# Phonological description: data-driven analysis

|   | Traditional analysis              | Data-driven analysis                                         |
|---|-----------------------------------|--------------------------------------------------------------|
| 1. | Done by trained linguist          | Evaluated by trained linguist                                |
| 2. | Can be done from scratch          | Previous description needed (or at least prior expectations) |
| 3. | Doesn’t care about amount of data | Care more about amount of data                               |
| 4. | Less reproducible                 | More reproducible                                            |
| 5. | Can not be automated              | Can be automated                                             |
\pause

Data-driven approach to phonological description and syllable structure analysis:

* was proposed in [@moroz2018]
* was applied to syllable structure  in [@moroz2019] to Adyghe data
* was applied to syllable structure in [@romanova2019] to Russian and Macedonian data

# Phonological description: data-driven analysis

The main steps:

* start with some language corpus (corpus, dictionary etc.)
* automatically extract phonological units (segments, features, syllable structure etc.) \pause

Further steps:

* obtained frequencies and inventories could be compared with the same units from other languages \pause

Advantages:

* more reproducible
* could be updated with new data, see ([Moroz 2019](https://github.com/agricolamz/2019.08.21-25_SLE_Leipzig/raw/master/2019.08.21-25_SLE_Leipzig.pdf))  slides from SLE on Bayesian typological research
* answers the question *'How often is X present in language(s)?'* rather than *'Is X present in language(s)?'*

# Andi and Botlikh villages

```{r, eval=FALSE}
library(tidyverse)
map <- read_csv("data/andi_botlikh_villages.csv")
map$eng[3] <- " "
map$eng[c(1, 2, 4, 7, 9, 10, 14, 16, 17)] <- paste(".      ", map$eng[c(1, 2, 4, 7, 9, 10, 14, 16, 17)])

library(lingtypology)
map.feature(map$language,
            features = map$language,
            latitude = map$lat,
            longitude = map$lon,
            label = map$eng,
            label.hide = FALSE,
            width = log(map$population)*1.5,
            tile = "Stamen.TerrainBackground",
            zoom.level = 11) ->
  m1

map.feature(map$language,
            latitude = map$lat,
            longitude = map$lon,
            label = map$eng,
            width = log(map$population)*2,
            tile = "Esri.WorldStreetMap",
            minimap = TRUE, 
            zoom.level = 5) ->
  m2

leafsync::latticeView(m1, m2)
```

![](images/02_map.png)

* Size of the dot corresponds with number of villages' inhabitants
* All villages except Botlikh are monoethnic
* Created with lingtypology package [@moroz2017]


# 

| Botlikh < Andic group < EC                                                                                                                | Andi < Andic group < EC                                                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
| Unwritten (can be written with extended Cyrillic script for Avar)                                                                         | Unwritten (can be written with extended Cyrillic script for Avar)                                               |
| ~5,000–8,000 speakers                                                                                                                     | ~16,500 speakers                                                                                                |
| Mostly spoken in 3 villages in northwestern Daghestan (Russian Federation): Botlikh, Miarso, Ashino, (Ankho); minor dialectal differences | About 14 villages; There are two main dialect groups: Lower Andi (Muni, Kvankhidatli) and Upper Andi (the rest) |
| One full reference grammar in Georgian [@gudava1962]                                                                                      | Several reference grammars [@suleymanov57] (Rikvani), [@salimov10] (Gagatli), [@tsertsvadze65] (Andi)           |
| Two dictionaries: [@saidovaabusov2012], [@alekseev2019]                                                                                   | No dictionary except [@kibrik1988]                                                                              |

# Comparing two Botlikh dictionaries

## [@saidovaabusov2012]

* Compiled in the 2000s by a native speaker (M. G. Abusov) and an experienced linguist (P. A. Saidova)
* Mostly Botlikh with some notes on Miarso \pause

## [@alekseev2019]

* Compiled in the 1960s / 1970s by a native speaker / philologist (X. G.
Azaev) and later (in the 2000s) systematized by an experienced
linguist (M. E. Alekseev)
* Subsequently edited by T. A. Maisak and scheduled for posthumous
publication last year
* Botlikh only \pause

## Summary:

* Dictionaries were compiled independently of each other
* with no metadata on the speakers consulted
* data collection was separated with several decades break

# Comparing two Botlikh dictionaries: data preparation

* Automatically merge two `.doc` file into one unified `.xls` file
* Manually check for similarities (S. Verhees, C. Naccarato and me)

# Comparing two Botlikh dictionaries: data preparation

```{r}
library(ggforce)
botlikh <- read_csv("data/botlikh.csv")

botlikh %>% 
  count(bind_id) %>% 
  na.omit() %>% 
  count() %>% 
  summarise(n = n - 77,
            sa = 8464 - n,
            aa = 6821 - n) %>% 
  pivot_longer(names_to = "type", values_to = "number", n:aa) %>% 
  mutate(prop = round(number/sum(number), 3),
         label = paste0(number, " lexemes\n", prop*100, "%"),
         x = c(-0.04, 0.25, -0.3), 
         r = 0,
         y  = 0) ->
  values

data.frame(x = c(0.15, -0.15),
           y = 0,
           y2 = c(0.39, 0.31),
           r = c((0.45+0.24)/2, (0.31+0.24)/2),
           label = c('Saidova, Abusov 2012\n8464 lexemes', 
                     'Alekseev, Azaev 2019\n6821 lexemes')) %>% 
  ggplot(aes(x0 = x, y0 = y, r = r, label = label)) +
  geom_circle(aes(fill = label), alpha = .2, size = 1, show.legend = FALSE) +
  geom_text(aes(x=x*1.9, y2), family = "Brill", size = 5)+
  geom_text(data = values, aes(x = x, y = y, label = label), family = "Brill", size = 6)+
  coord_fixed()+
  theme_void()+
  ylim(-0.4, 0.4) ->
  venn
ggsave(filename = "images/03_venn.png", venn, device = "png", width = 6, height = 5)
```

![](images/03_venn.png)

# Comparing two Botlikh dictionaries: results

```{r}
botlikh %>% 
  select(bind_id, reference, lemma) %>% 
  mutate(lemma = str_remove_all(lemma, "[=/-]")) %>% 
  na.omit() %>% 
  pivot_wider(names_from = reference, values_from = lemma) %>% 
  unnest(cols = c(`Saidova, Abusov 2012`, `Alekseev 2006`)) %>% 
  na.omit() %>% 
  summarise(phonetic_same = sum(`Saidova, Abusov 2012` == `Alekseev 2006`),
            phonetic_diff = sum(`Saidova, Abusov 2012` != `Alekseev 2006`),
            phonetic_same_str = sum(str_remove_all(`Saidova, Abusov 2012`, stress) == str_remove_all(`Alekseev 2006`, stress)),
            phonetic_diff_str = sum(str_remove_all(`Saidova, Abusov 2012`, stress) != str_remove_all(`Alekseev 2006`, stress)),
            n_stress_same = sum(str_count(`Saidova, Abusov 2012`, stress) == str_count(`Alekseev 2006`, stress)),
            n_stress_diff = sum(str_count(`Saidova, Abusov 2012`, stress) != str_count(`Alekseev 2006`, stress))) ->
  results
```

* There are `r results$phonetic_same` lexemes which look phonetically the same, and `r results$phonetic_diff` are different (`r round(results$phonetic_diff/(results$phonetic_diff+results$phonetic_same)*100)`%)
* If we remove the stress sign, there are `r results$phonetic_same_str` lexemes which look phonetically the same, and `r results$phonetic_diff_str` are different (`r round(results$phonetic_diff_str/(results$phonetic_same_str+results$phonetic_diff_str)*100)`%)
* ⇒ `r round(results$phonetic_diff/(results$phonetic_diff+results$phonetic_same)*100) - round(results$phonetic_diff_str/(results$phonetic_same_str+results$phonetic_diff_str)*100)`% of lexemes have different stress pattern?.. \pause Yes, but including `r results$n_stress_diff` (`r round(results$n_stress_diff/(results$n_stress_diff+results$n_stress_same)*100)`%) cases where stress is present in one dictionary and absent in the other. \pause

* What causes the difference between dictionaries?
    * Stress pattern differences in `r results$phonetic_diff-results$phonetic_diff_str- results$n_stress_diff` lexemes (about `r round((results$phonetic_diff-results$phonetic_diff_str- results$n_stress_diff)/(results$phonetic_same+results$phonetic_diff)*100)`%)
    * Multiple cases where there is a small difference that could be
explained either as a typo or in terms phonological variation: *č**u**hí* ‘to run’ [aa] vs. *č**ũ**hí* [sa], *ku**s**u* ‘cherry plum’ [aa] vs. *ku**sː**u* [sa]
    * Multiple cases where Russian borrowings were adopted differently: *a**w**tobus* ‘bus’ [aa] vs. *a**b**tabus* [sa], *bit**o**n* ‘milk can’ [aa] vs. *bit**u**n* [sa], *a**p**teka* ‘pharmacy’ [aa] vs. *a**b**teka* [sa]
    * Morphological preferences: *dinija=**w*** 'pious' [aa] vs. *dinija=**b*** [sa]

# Comparing two Botlikh dictionaries: results

| [@alekseev2019] | [@saidovaabusov2012] |                  |
|-----------------|----------------------|------------------|
| *ãha**j**r*     | *ãhar*               | ’message’        |
| *beʒa**j**r*    | *beʒir*              | ’roasting’       |
| *mik’ku**j**r*  | *mik’ːur*            | ’swallowing’     |
| *reqχu**j**r*   | *reqχwir*            | ’fight’          |
| *reʃku**j**r*   | *reʃkur*             | ’overnight stay’ |
| *rikwa**j**r*   | *rikwar*             | ’lighting’       |
| ...             | ...                  | ...              |
| *χwardar*       | *χwardir*            | ’digging’        |
| *miʔar*         | *miʔar*              | ’nose’           |
| ...             | ...                  | ...              |
| *ʃːalaj*        | *ʃːallaj*            | ’silt’           |
| *inuʕala*       | *inuʕalla*           | ’everywhere’     |
| *ʕila*          | *ʕilla*              | ’reason’         |

# Comparing two Botlikh dictionaries: without stress

```{r}
botlikh %>% 
  group_by(bind_id, reference) %>% 
  mutate(n = n()) %>% 
  filter(n<2) %>% 
  select(bind_id, reference, lemma, text) %>%
  pivot_wider(names_from = reference, values_from = c(lemma, text)) %>% 
  na.omit() %>% 
  rename(lemma_alekseev_azaev = `lemma_Alekseev 2006`,
         lemma_saidova_abusov = `lemma_Saidova, Abusov 2012`,
         text_alekseev_azaev = `text_Alekseev 2006`,
         text_saidova_abusov = `text_Saidova, Abusov 2012`) %>% 
  ungroup() %>% 
  mutate(new_id = 1:n()) %>%   # filter(new_id == 488)
  #  pivot_longer(names_to = "reference", values_to = "lemma") %>%
  mutate(lemma_alekseev_azaev = str_replace_all(lemma_alekseev_azaev, "i", "I"),
         lemma_alekseev_azaev = str_replace_all(lemma_alekseev_azaev, "І", "I"),
         lemma_saidova_abusov = str_replace_all(lemma_saidova_abusov, "i", "I"),
         lemma_saidova_abusov = str_replace_all(lemma_saidova_abusov, "І", "I"),
         ipa_aa = str_remove_all(lemma_alekseev_azaev, " ?//.*"),
         ipa_aa = str_replace_all(ipa_aa, paste0("-а", stress, "ᴴ"), "-ʔ-a`-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("-а", "ᴴ"), "-ʔ-ã-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("-а", stress), "-ʔ-a`-"),
         ipa_aa = str_replace_all(ipa_aa, "-а:", "-ʔ-aː-"),
         ipa_aa = str_replace_all(ipa_aa, "-а", "-ʔ-a-"),
         ipa_aa = str_remove_all(ipa_aa, "[-/=\\\\]"),
         ipa_aa = str_replace_all(ipa_aa, "ʔa", "-ʔ-a-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("а", stress, "ᴴ"), "-ã`-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("а", "ᴴ"), "-ã-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("а", stress), "-a`-"),
         ipa_aa = str_replace_all(ipa_aa, "а", "-a-"),
         ipa_aa = str_replace_all(ipa_aa, "б", "-b-"),
         ipa_aa = str_replace_all(ipa_aa, "гъв", "-ʁʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "гъ", "-ʁ-"),
         ipa_aa = str_replace_all(ipa_aa, "гI", "-ʕ-"),
         ipa_aa = str_replace_all(ipa_aa, "гь", "-h-"),
         ipa_aa = str_replace_all(ipa_aa, "гь", "-h-"),
         ipa_aa = str_replace_all(ipa_aa, "гв", "-ɡʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "г", "-ɡ-"),
         ipa_aa = str_replace_all(ipa_aa, "дж", "-dʒ-"),
         ipa_aa = str_replace_all(ipa_aa, "д", "-d-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("е", stress, "ᴴ"), "-ẽ`-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("е", "ᴴ"), "-ẽ-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("е", stress), "-e`-"),
         ipa_aa = str_replace_all(ipa_aa, "е", "-e-"),
         ipa_aa = str_replace_all(ipa_aa, "ж", "-ʒ-"),
         ipa_aa = str_replace_all(ipa_aa, "зв", "-zʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "з", "-z-"),
         ipa_aa = str_replace_all(ipa_aa, "з", "-z-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("и", stress, "ᴴ"), "-ĩ`-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("и", "ᴴ"), "-ĩ-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("и", stress), "-i`-"),
         ipa_aa = str_replace_all(ipa_aa, "и", "-i-"),
         ipa_aa = str_replace_all(ipa_aa, "й", "-j-"),
         ipa_aa = str_replace_all(ipa_aa, "кIкIв", "-k'ːʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "кькьв", "-tɬ'ːʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "кIкI", "-k'ː-"),
         ipa_aa = str_replace_all(ipa_aa, "кькь", "-tɬ'ː-"),
         ipa_aa = str_replace_all(ipa_aa, "ккв", "-kːʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "къв", "-qχ'ʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "кIв", "-k'ʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "кьв", "-tɬ'ʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "кк", "-kː-"),
         ipa_aa = str_replace_all(ipa_aa, "кI", "-k'-"),
         ipa_aa = str_replace_all(ipa_aa, "кв", "-kʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "къ", "-qχ'-"),
         ipa_aa = str_replace_all(ipa_aa, "кь", "-tɬ'-"),
         ipa_aa = str_replace_all(ipa_aa, "к", "-k-"),
         ipa_aa = str_replace_all(ipa_aa, "лълъв", "-ɬːʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "лIлIв", "-tɬːʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "лълъ", "-ɬː-"),
         ipa_aa = str_replace_all(ipa_aa, "лIлI", "-tɬː-"),
         ipa_aa = str_replace_all(ipa_aa, "лъв", "-ɬʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "лIв", "-tɬʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "лъ", "-ɬ-"),
         ipa_aa = str_replace_all(ipa_aa, "лI", "-tɬ-"),
         ipa_aa = str_replace_all(ipa_aa, "л", "-l-"),
         ipa_aa = str_replace_all(ipa_aa, "м", "-m-"),
         ipa_aa = str_replace_all(ipa_aa, "н", "-n-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("о", stress, "ᴴ"), "-õ`-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("о", "ᴴ"), "-õ-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("о", stress), "-o`-"),
         ipa_aa = str_replace_all(ipa_aa, "о", "-o-"),
         ipa_aa = str_replace_all(ipa_aa, "п", "-p-"),
         ipa_aa = str_replace_all(ipa_aa, "пI", "-p'-"),
         ipa_aa = str_replace_all(ipa_aa, "пп", "-pː-"),
         ipa_aa = str_replace_all(ipa_aa, "р", "-r-"),
         ipa_aa = str_replace_all(ipa_aa, "сс", "-sː-"),
         ipa_aa = str_replace_all(ipa_aa, "св", "-sʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "с", "-s-"), 
         ipa_aa = str_replace_all(ipa_aa, "тI", "-t'-"),
         ipa_aa = str_replace_all(ipa_aa, "тт", "-tː-"),
         ipa_aa = str_replace_all(ipa_aa, "т", "-t-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("у", stress, "ᴴ"), "-ũ'-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("у", "ᴴ"), "-ũ-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("у", stress), "-u`-"),
         ipa_aa = str_replace_all(ipa_aa, "у", "-u-"),
         ipa_aa = str_replace_all(ipa_aa, "ф", "-f-"),
         ipa_aa = str_replace_all(ipa_aa, "ххв", "-χːʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "хьв", "-çʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "хъв", "-qχʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "хх", "-χː-"),
         ipa_aa = str_replace_all(ipa_aa, "хI", "-ħ-"),
         ipa_aa = str_replace_all(ipa_aa, "хъ", "-qχ-"),
         ipa_aa = str_replace_all(ipa_aa, "хь", "-ç-"),
         ipa_aa = str_replace_all(ipa_aa, "х", "-χ-"),
         ipa_aa = str_replace_all(ipa_aa, "цIцIв", "-ts'ːʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "цIцI", "-ts'ː-"),
         ipa_aa = str_replace_all(ipa_aa, "цIв", "-ts'ʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "ццв", "-tsːʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "цI", "-ts'-"),
         ipa_aa = str_replace_all(ipa_aa, "цц", "-tsː-"),
         ipa_aa = str_replace_all(ipa_aa, "цв", "-tsʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "ц", "-ts-"),
         ipa_aa = str_replace_all(ipa_aa, "чIчIв", "-tʃ'ːʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "чIчI", "-tʃ'ː-"),
         ipa_aa = str_replace_all(ipa_aa, "чIв", "-tʃ'ʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "ччв", "-tʃːʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "чI", "-tʃ'-"),
         ipa_aa = str_replace_all(ipa_aa, "чч", "-tʃː-"),
         ipa_aa = str_replace_all(ipa_aa, "чв", "-tʃʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "ч", "-tʃ-"),
         ipa_aa = str_replace_all(ipa_aa, "ш", "-ʃ-"),
         ipa_aa = str_replace_all(ipa_aa, "щ", "-ʃː-"),
         ipa_aa = str_replace_all(ipa_aa, "ъв", "-ʔʷ-"),
         ipa_aa = str_replace_all(ipa_aa, "ъ", "-ʔ-"),
         ipa_aa = str_replace_all(ipa_aa, "я", "-j-a-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("э", stress, "ᴴ"), "-ʔ-ẽ`-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("э", "ᴴ"), "-ʔ-ẽ-"),
         ipa_aa = str_replace_all(ipa_aa, paste0("э", stress), "-ʔ-e`-"),
         ipa_aa = str_replace_all(ipa_aa, "э", "-ʔ-e-"),
         ipa_sa = str_replace_all(ipa_aa, "я", "-j-a-"),
         ipa_aa = str_replace_all(ipa_aa, "в", "-w-"),
         ipa_aa = str_replace_all(ipa_aa, "-’", "’"),
         ipa_aa = str_replace_all(ipa_aa, "-:", "ː"),
         ipa_aa = str_replace_all(ipa_aa, "-{2,}", "-"),
         ipa_aa = str_replace_all(ipa_aa, "-\\(", "\\("),
         ipa_aa = str_replace_all(ipa_aa, "-\\)", "\\)"),
         ipa_aa = str_remove_all(ipa_aa, "^-"),
         ipa_aa = str_remove_all(ipa_aa, "^ʔ-"),
         ipa_aa = str_remove_all(ipa_aa, "-$"),
         ipa_sa = str_remove_all(lemma_saidova_abusov, " ?//.*"),
         ipa_sa = str_replace_all(ipa_sa, paste0("-а", stress, "ᴴ"), "-ʔ-a`-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("-а", "ᴴ"), "-ʔ-ã-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("-а", stress), "-ʔ-a`-"),
         ipa_sa = str_replace_all(ipa_sa, "-а:", "-ʔ-aː-"),
         ipa_sa = str_replace_all(ipa_sa, "-а", "-ʔ-a-"),
         ipa_sa = str_remove_all(ipa_sa, "[-/=\\\\]"),
         ipa_sa = str_replace_all(ipa_sa, "ʔa", "-ʔ-a-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("а", stress, "ᴴ"), "-ã`-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("а", "ᴴ"), "-ã-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("а", stress), "-a`-"),
         ipa_sa = str_replace_all(ipa_sa, "а", "-a-"),
         ipa_sa = str_replace_all(ipa_sa, "б", "-b-"),
         ipa_sa = str_replace_all(ipa_sa, "гъв", "-ʁʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "гъ", "-ʁ-"),
         ipa_sa = str_replace_all(ipa_sa, "гI", "-ʕ-"),
         ipa_sa = str_replace_all(ipa_sa, "гь", "-h-"),
         ipa_sa = str_replace_all(ipa_sa, "гь", "-h-"),
         ipa_sa = str_replace_all(ipa_sa, "гв", "-ɡʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "г", "-ɡ-"),
         ipa_sa = str_replace_all(ipa_sa, "дж", "-dʒ-"),
         ipa_sa = str_replace_all(ipa_sa, "д", "-d-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("е", stress, "ᴴ"), "-ẽ`-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("е", "ᴴ"), "-ẽ-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("е", stress), "-e`-"),
         ipa_sa = str_replace_all(ipa_sa, "е", "-e-"),
         ipa_sa = str_replace_all(ipa_sa, "ж", "-ʒ-"),
         ipa_sa = str_replace_all(ipa_sa, "зв", "-zʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "з", "-z-"),
         ipa_sa = str_replace_all(ipa_sa, "з", "-z-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("и", stress, "ᴴ"), "-ĩ`-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("и", "ᴴ"), "-ĩ-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("и", stress), "-i`-"),
         ipa_sa = str_replace_all(ipa_sa, "и", "-i-"),
         ipa_sa = str_replace_all(ipa_sa, "й", "-j-"),
         ipa_sa = str_replace_all(ipa_sa, "кIкIв", "-k'ːʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "кькьв", "-tɬ'ːʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "кIкI", "-k'ː-"),
         ipa_sa = str_replace_all(ipa_sa, "кькь", "-tɬ'ː-"),
         ipa_sa = str_replace_all(ipa_sa, "ккв", "-kːʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "къв", "-qχ'ʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "кIв", "-k'ʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "кьв", "-tɬ'ʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "кк", "-kː-"),
         ipa_sa = str_replace_all(ipa_sa, "кI", "-k'-"),
         ipa_sa = str_replace_all(ipa_sa, "кв", "-kʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "къ", "-qχ'-"),
         ipa_sa = str_replace_all(ipa_sa, "кь", "-tɬ'-"),
         ipa_sa = str_replace_all(ipa_sa, "к", "-k-"),
         ipa_sa = str_replace_all(ipa_sa, "лълъв", "-ɬːʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "лIлIв", "-tɬːʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "лълъ", "-ɬː-"),
         ipa_sa = str_replace_all(ipa_sa, "лIлI", "-tɬː-"),
         ipa_sa = str_replace_all(ipa_sa, "лъв", "-ɬʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "лIв", "-tɬʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "лъ", "-ɬ-"),
         ipa_sa = str_replace_all(ipa_sa, "лI", "-tɬ-"),
         ipa_sa = str_replace_all(ipa_sa, "л", "-l-"),
         ipa_sa = str_replace_all(ipa_sa, "м", "-m-"),
         ipa_sa = str_replace_all(ipa_sa, "н", "-n-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("о", stress, "ᴴ"), "-õ`-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("о", "ᴴ"), "-õ-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("о", stress), "-o`-"),
         ipa_sa = str_replace_all(ipa_sa, "о", "-o-"),
         ipa_sa = str_replace_all(ipa_sa, "п", "-p-"),
         ipa_sa = str_replace_all(ipa_sa, "пI", "-p'-"),
         ipa_sa = str_replace_all(ipa_sa, "пп", "-pː-"),
         ipa_sa = str_replace_all(ipa_sa, "р", "-r-"),
         ipa_sa = str_replace_all(ipa_sa, "сс", "-sː-"),
         ipa_sa = str_replace_all(ipa_sa, "св", "-sʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "с", "-s-"), 
         ipa_sa = str_replace_all(ipa_sa, "тI", "-t'-"),
         ipa_sa = str_replace_all(ipa_sa, "тт", "-tː-"),
         ipa_sa = str_replace_all(ipa_sa, "т", "-t-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("у", stress, "ᴴ"), "-ũ'-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("у", "ᴴ"), "-ũ-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("у", stress), "-u`-"),
         ipa_sa = str_replace_all(ipa_sa, "у", "-u-"),
         ipa_sa = str_replace_all(ipa_sa, "ф", "-f-"),
         ipa_sa = str_replace_all(ipa_sa, "ххв", "-χːʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "хьв", "-çʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "хъв", "-qχʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "хх", "-χː-"),
         ipa_sa = str_replace_all(ipa_sa, "хI", "-ħ-"),
         ipa_sa = str_replace_all(ipa_sa, "хъ", "-qχ-"),
         ipa_sa = str_replace_all(ipa_sa, "хь", "-ç-"),
         ipa_sa = str_replace_all(ipa_sa, "х", "-χ-"),
         ipa_sa = str_replace_all(ipa_sa, "цIцIв", "-ts'ːʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "цIцI", "-ts'ː-"),
         ipa_sa = str_replace_all(ipa_sa, "цIв", "-ts'ʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "ццв", "-tsːʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "цI", "-ts'-"),
         ipa_sa = str_replace_all(ipa_sa, "цц", "-tsː-"),
         ipa_sa = str_replace_all(ipa_sa, "цв", "-tsʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "ц", "-ts-"),
         ipa_sa = str_replace_all(ipa_sa, "чIчIв", "-tʃ'ːʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "чIчI", "-tʃ'ː-"),
         ipa_sa = str_replace_all(ipa_sa, "чIв", "-tʃ'ʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "ччв", "-tʃːʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "чI", "-tʃ'-"),
         ipa_sa = str_replace_all(ipa_sa, "чч", "-tʃː-"),
         ipa_sa = str_replace_all(ipa_sa, "чч", "-tʃː-"),
         ipa_sa = str_replace_all(ipa_sa, "чв", "-tʃʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "ч", "-tʃ-"),
         ipa_sa = str_replace_all(ipa_sa, "ш", "-ʃ-"),
         ipa_sa = str_replace_all(ipa_sa, "щ", "-ʃː-"),
         ipa_sa = str_replace_all(ipa_sa, "ъв", "-ʔʷ-"),
         ipa_sa = str_replace_all(ipa_sa, "ъ", "-ʔ-"),
         ipa_sa = str_replace_all(ipa_sa, "ю", "-j-u-"),
         ipa_sa = str_replace_all(ipa_sa, "я", "-j-a-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("э", stress, "ᴴ"), "-ʔ-ẽ`-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("э", "ᴴ"), "-ʔ-ẽ-"),
         ipa_sa = str_replace_all(ipa_sa, paste0("э", stress), "-ʔ-e`-"),
         ipa_sa = str_replace_all(ipa_sa, "э", "-ʔ-e-"),
         ipa_sa = str_replace_all(ipa_sa, "в", "-w-"),
         ipa_sa = str_replace_all(ipa_sa, "-:", "ː"),
         ipa_sa = str_replace_all(ipa_sa, "-{2,}", "-"),
         ipa_sa = str_replace_all(ipa_sa, "-\\(", "\\("),
         ipa_sa = str_replace_all(ipa_sa, "-\\)", "\\)"),
         ipa_sa = str_remove_all(ipa_sa, "^-"),
         ipa_sa = str_remove_all(ipa_sa, "^ʔ-"),
         ipa_sa = str_remove_all(ipa_sa, "-$"))  %>% 
  filter(!str_detect(ipa_aa, " "),
         !str_detect(ipa_sa, " ")) %>% 
  mutate(str_aa = str_detect(ipa_aa, "`"),
         str_sa = str_detect(ipa_sa, "`")) %>% 
#   filter(str_aa, str_sa) %>% # remove rows with unstressed words
#   mutate(ipa_aa = str_remove_all(ipa_aa, "`"),
#         ipa_sa = str_remove_all(ipa_sa, "`")) %>%
  mutate(simmilar = ipa_aa == ipa_sa) ->
  botlikh_analyse

options(scipen = 999)
botlikh_analyse %>% 
  mutate(ipa_aa = str_remove_all(ipa_aa, "`"),
         ipa_sa = str_remove_all(ipa_sa, "`")) %>%
  select(ipa_aa, ipa_sa, bind_id) %>% 
  pivot_longer(names_to = "reference", values_to = "words", ipa_aa:ipa_sa) %>% 
  mutate(reference = str_remove(reference, "ipa_")) %>% 
  mutate(words = str_remove_all(words, "[\\(\\)]")) %>% 
  mutate(words = str_replace(words, "tʃI", "tʃ'")) %>% # repaire qχ'ʷa`ntʃ(I)i	
  unnest_tokens(sound, words, token = stringr::str_split, pattern = "-") %>% 
  count(reference, sound, sort = TRUE) %>% 
  filter(sound != "") %>%
  spread(reference, n, fill = 0.1) %>% 
  mutate(difference = sa - aa) %>% 
  ggplot(aes(sa, aa, label = sound, fill = difference)) + 
  geom_abline(slope = 1, intercept = 0, linetype = 2)+
  geom_point()+
  ggrepel::geom_label_repel(size = 6, segment.color =  "black", segment.alpha = 0.5, color = "white", family = "Brill")+
  scale_x_log10()+
  scale_y_log10()+
  scale_fill_continuous(type = "viridis")+
  labs(x = "Number of utterances in [Alekseev, Azaev 2019] (log scale)",
       y = "Number of utterances in [Saidova, Abusov 2012] (log scale)")
```

# Comparing two Botlikh dictionaries: with stress

```{r}
botlikh_analyse %>% 
  select(ipa_aa, ipa_sa, bind_id) %>% 
  pivot_longer(names_to = "reference", values_to = "words", ipa_aa:ipa_sa) %>% 
  mutate(reference = str_remove(reference, "ipa_")) %>% 
  mutate(words = str_remove_all(words, "[\\(\\)]")) %>% 
  mutate(words = str_replace(words, "tʃI", "tʃ'")) %>% # repaire qχ'ʷa`ntʃ(I)i	
  unnest_tokens(sound, words, token = stringr::str_split, pattern = "-") %>% 
  count(reference, sound, sort = TRUE) %>% 
  filter(sound != "") %>%
  spread(reference, n, fill = 0.1) %>% 
  mutate(difference = sa - aa) %>% 
  ggplot(aes(sa, aa, label = sound, fill = difference)) + 
  geom_abline(slope = 1, intercept = 0, linetype = 2)+
  geom_point()+
  ggrepel::geom_label_repel(size = 6, segment.color =  "black", segment.alpha = 0.5, color = "white", family = "Brill")+
  scale_x_log10()+
  scale_y_log10()+
  scale_fill_continuous(type = "viridis")+
  labs(x = "Number of utterances in [Alekseev, Azaev 2019] (log scale)",
       y = "Number of utterances in [Saidova, Abusov 2012] (log scale)")
```

# Zilo Andi data

Dictionary data for Zilo were collected during fieldtrips to Zilo in 2016–2019 with N. Rochant, S. Verhees, A. Martynova and A. Zakirova who contributed to the same FieldWorks project.

* Contain morphological affixes
* Doesn’t contain additional affixes in a lemma form
* Contain different stems of the same lexeme (e. g. SG.ABS, SG.OBL, PL.ABS, PL.OBL, PST, NPST). Those forms were removed during the analysis.
* No information about stress

```{r}
andi <- read_csv("data/andi_dict.csv")
andi %>% 
  filter(is.na(remove),
         !str_detect(rus, "pl"),
         !str_detect(rus, "obl"),
         !str_detect(rus, "¬pst")) %>% 
  mutate(zilo_l = str_replace_all(zilo_l, "(<CL>)|(-CL)|(CL-)", "b"),
         zilo_l = str_replace_all(zilo_l, "V-", "i"),
         zilo_l = str_remove_all(zilo_l, "(\\))|(\\()"),
         zilo_l = str_replace_all(zilo_l, "tɬ'ːʷ", "-tɬ'ːʷ-"),
         zilo_l = str_replace_all(zilo_l, "ts'ːʷ", "-ts'ːʷ-"),
         zilo_l = str_replace_all(zilo_l, "tʃ'ːʷ", "-tʃ'ːʷ-"),
         zilo_l = str_replace_all(zilo_l, "ts'ʷ", "-ts'ʷ-"),
         zilo_l = str_replace_all(zilo_l, "qχ'ʷ", "-qχ'ʷ-"),
         zilo_l = str_replace_all(zilo_l, "tɬːʷ", "-tɬːʷ-"),
         zilo_l = str_replace_all(zilo_l, "t'ːʷ", "-t'ːʷ-"),
         zilo_l = str_replace_all(zilo_l, "ts'ː", "-ts'ː-"),
         zilo_l = str_replace_all(zilo_l, "tsːʷ", "-tsːʷ-"),
         zilo_l = str_replace_all(zilo_l, "tʃ'ː", "-tʃ'ː-"),
         zilo_l = str_replace_all(zilo_l, "k'ːʷ", "-k'ːʷ-"),
         zilo_l = str_replace_all(zilo_l, "tɬ'ʷ", "-tɬ'ʷ-"),
         zilo_l = str_replace_all(zilo_l, "p'ːʷ", "-p'ːʷ-"),
         zilo_l = str_replace_all(zilo_l, "tʃ'ʷ", "-tʃ'ʷ-"),
         zilo_l = str_replace_all(zilo_l, "tʃːʷ", "-tʃːʷ-"),
         zilo_l = str_replace_all(zilo_l, "t'ʷ", "-t'ʷ-"),
         zilo_l = str_replace_all(zilo_l, "tɬ'", "-tɬ'-"),
         zilo_l = str_replace_all(zilo_l, "p'ʷ", "-p'ʷ-"),
         zilo_l = str_replace_all(zilo_l, "pːʷ", "-pːʷ-"),
         zilo_l = str_replace_all(zilo_l, "sːʷ", "-sːʷ-"),
         zilo_l = str_replace_all(zilo_l, "ts'", "-ts'-"),
         zilo_l = str_replace_all(zilo_l, "tʃ'", "-tʃ'-"),
         zilo_l = str_replace_all(zilo_l, "kːʷ", "-kːʷ-"),
         zilo_l = str_replace_all(zilo_l, "tɬʷ", "-tɬʷ-"),
         zilo_l = str_replace_all(zilo_l, "tɬː", "-tɬː-"),
         zilo_l = str_replace_all(zilo_l, "õ", "-õ-"),
         zilo_l = str_replace_all(zilo_l, "p'ː", "-p'ː-"),
         zilo_l = str_replace_all(zilo_l, "qχʷ", "-qχʷ-"),
         zilo_l = str_replace_all(zilo_l, "çːʷ", "-çːʷ-"),
         zilo_l = str_replace_all(zilo_l, "tsʷ", "-tsʷ-"),
         zilo_l = str_replace_all(zilo_l, "tsː", "-tsː-"),
         zilo_l = str_replace_all(zilo_l, "k'ː", "-k'ː-"),
         zilo_l = str_replace_all(zilo_l, "t'ː", "-t'ː-"),
         zilo_l = str_replace_all(zilo_l, "χːʷ", "-χːʷ-"),
         zilo_l = str_replace_all(zilo_l, "tʃː", "-tʃː-"),
         zilo_l = str_replace_all(zilo_l, "ʃːʷ", "-ʃːʷ-"),
         zilo_l = str_replace_all(zilo_l, "k'ʷ", "-k'ʷ-"),
         zilo_l = str_replace_all(zilo_l, "tːʷ", "-tːʷ-"),
         zilo_l = str_replace_all(zilo_l, "ʒʷ", "-ʒʷ-"),
         zilo_l = str_replace_all(zilo_l, "pː", "-pː-"),
         zilo_l = str_replace_all(zilo_l, "hʷ", "-hʷ-"),
         zilo_l = str_replace_all(zilo_l, "ẽ", "-ẽ-"),
         zilo_l = str_replace_all(zilo_l, "k'", "-k'-"),
         zilo_l = str_replace_all(zilo_l, "ɬː", "-ɬː-"),
         zilo_l = str_replace_all(zilo_l, "p'", "-p'-"),
         zilo_l = str_replace_all(zilo_l, "pʷ", "-pʷ-"),
         zilo_l = str_replace_all(zilo_l, "sʷ", "-sʷ-"),
         zilo_l = str_replace_all(zilo_l, "qχ", "-qχ-"),
         zilo_l = str_replace_all(zilo_l, "çː", "-çː-"),
         zilo_l = str_replace_all(zilo_l, "ʃʷ", "-ʃʷ-"),
         zilo_l = str_replace_all(zilo_l, "ɡʷ", "-ɡʷ-"),
         zilo_l = str_replace_all(zilo_l, "dʷ", "-dʷ-"),
         zilo_l = str_replace_all(zilo_l, "zʷ", "-zʷ-"),
         zilo_l = str_replace_all(zilo_l, "ĩ", "-ĩ-"),
         zilo_l = str_replace_all(zilo_l, "kː", "-kː-"),
         zilo_l = str_replace_all(zilo_l, "lʔ", "-lʔ-"),
         zilo_l = str_replace_all(zilo_l, "lʷ", "-lʷ-"),
         zilo_l = str_replace_all(zilo_l, "nʷ", "-nʷ-"),
         zilo_l = str_replace_all(zilo_l, "rʷ", "-rʷ-"),
         zilo_l = str_replace_all(zilo_l, "t'", "-t'-"),
         zilo_l = str_replace_all(zilo_l, "ħʷ", "-ħʷ-"),
         zilo_l = str_replace_all(zilo_l, "χʷ", "-χʷ-"),
         zilo_l = str_replace_all(zilo_l, "χː", "-χː-"),
         zilo_l = str_replace_all(zilo_l, "çʷ", "-çʷ-"),
         zilo_l = str_replace_all(zilo_l, "ʃː", "-ʃː-"),
         zilo_l = str_replace_all(zilo_l, "ʔʷ", "-ʔʷ-"),
         zilo_l = str_replace_all(zilo_l, "ã", "-ã-"),
         zilo_l = str_replace_all(zilo_l, "ʁʷ", "-ʁʷ-"),
         zilo_l = str_replace_all(zilo_l, "dː", "-dː-"),
         zilo_l = str_replace_all(zilo_l, "kʷ", "-kʷ-"),
         zilo_l = str_replace_all(zilo_l, "mʷ", "-mʷ-"),
         zilo_l = str_replace_all(zilo_l, "sː", "-sː-"),
         zilo_l = str_replace_all(zilo_l, "tʷ", "-tʷ-"),
         zilo_l = str_replace_all(zilo_l, "tː", "-tː-"),
         zilo_l = str_replace_all(zilo_l, "ũ", "-ũ-"),
         zilo_l = str_replace_all(zilo_l, "w", "-w-"),
         zilo_l = str_replace_all(zilo_l, "h", "-h-"),
         zilo_l = str_replace_all(zilo_l, "l", "-l-"),
         zilo_l = str_replace_all(zilo_l, "o", "-o-"),
         zilo_l = str_replace_all(zilo_l, "a", "-a-"),
         zilo_l = str_replace_all(zilo_l, "b", "-b-"),
         zilo_l = str_replace_all(zilo_l, "ʕ", "-ʕ-"),
         zilo_l = str_replace_all(zilo_l, "ʁ", "-ʁ-"),
         zilo_l = str_replace_all(zilo_l, "ʒ", "-ʒ-"),
         zilo_l = str_replace_all(zilo_l, "j", "-j-"),
         zilo_l = str_replace_all(zilo_l, "k", "-k-"),
         zilo_l = str_replace_all(zilo_l, "m", "-m-"),
         zilo_l = str_replace_all(zilo_l, "n", "-n-"),
         zilo_l = str_replace_all(zilo_l, "s", "-s-"),
         zilo_l = str_replace_all(zilo_l, "ɡ", "-ɡ-"),
         zilo_l = str_replace_all(zilo_l, "d", "-d-"),
         zilo_l = str_replace_all(zilo_l, "e", "-e-"),
         zilo_l = str_replace_all(zilo_l, "i", "-i-"),
         zilo_l = str_replace_all(zilo_l, "ɬ", "-ɬ-"),
         zilo_l = str_replace_all(zilo_l, "p", "-p-"),
         zilo_l = str_replace_all(zilo_l, "r", "-r-"),
         zilo_l = str_replace_all(zilo_l, "χ", "-χ-"),
         zilo_l = str_replace_all(zilo_l, "ç", "-ç-"),
         zilo_l = str_replace_all(zilo_l, "z", "-z-"),
         zilo_l = str_replace_all(zilo_l, "u", "-u-"),
         zilo_l = str_replace_all(zilo_l, "f", "-f-"),
         zilo_l = str_replace_all(zilo_l, "ħ", "-ħ-"),
         zilo_l = str_replace_all(zilo_l, "ʃ", "-ʃ-"),
         zilo_l = str_replace_all(zilo_l, "t", "-t-"),
         zilo_l = str_replace_all(zilo_l, "ʔ", "-ʔ-"),
         zilo_l = str_replace_all(zilo_l, "-{2,}", "-"),
         zilo_l = str_replace_all(zilo_l, "-'", "'"),
         zilo_l = str_replace_all(zilo_l, "-ʷ", "ʷ"),
         zilo_l = str_replace_all(zilo_l, "-ː", "ː"),
         zilo_l = str_replace_all(zilo_l, "t-ʃ", "tʃ"),
         zilo_l = str_replace_all(zilo_l, "t-ʃ'", "tʃ'"),
         zilo_l = str_replace_all(zilo_l, "t-ɬ", "tɬ"),
         zilo_l = str_replace_all(zilo_l, "t-s", "ts"),
         zilo_l = str_replace_all(zilo_l, "t-ɬ", "tɬ"),
         zilo_l = str_replace_all(zilo_l, "t-ʃʷ", "tʃʷ"),
         zilo_l = str_replace_all(zilo_l, "d-ʒʷ", "dʒʷ"),
         zilo_l = str_replace_all(zilo_l, "d-ʒ", "dʒ"),
         zilo_l = str_replace_all(zilo_l, "q-χ'", "qχ'"),
         zilo_l = str_replace_all(zilo_l, "q-χ", "qχ"),
         zilo_l = str_replace_all(zilo_l, "q-χʷ", "qχʷ"),
         zilo_l = str_replace_all(zilo_l, "t-ɬ'ː", "tɬ'ː"),
         zilo_l = str_replace_all(zilo_l, "t-ɬ'", "tɬ'"),
         zilo_l = str_remove_all(zilo_l, "^-"),
         zilo_l = str_remove_all(zilo_l, "-$"),
         zilo_l = str_remove_all(zilo_l, "<"),
         zilo_l = str_remove_all(zilo_l, ">"),
         zilo_l = str_replace_all(zilo_l, "1", "i")) %>% 
  select(zilo_l) ->
  zilo_analyse
  
zilo_analyse  %>% 
  unnest_tokens(sound, zilo_l, token = stringr::str_split, pattern = "-") %>% 
  count(sound, sort = TRUE) %>% 
  filter(sound != "ь",
         sound != "") %>% 
  mutate(reference = "zilo") ->
  zilo_data

botlikh_analyse %>% 
    mutate(ipa_aa = str_remove_all(ipa_aa, "`"),
           ipa_sa = str_remove_all(ipa_sa, "`")) %>%
    select(ipa_aa, ipa_sa, bind_id) %>% 
    pivot_longer(names_to = "reference", values_to = "words", ipa_aa:ipa_sa) %>% 
    mutate(reference = str_remove(reference, "ipa_")) %>% 
    mutate(words = str_remove_all(words, "[\\(\\)]")) %>% 
    mutate(words = str_replace(words, "tʃI", "tʃ'")) %>% # repaire qχ'ʷa`ntʃ(I)i	
    unnest_tokens(sound, words, token = stringr::str_split, pattern = "-") %>% 
    count(reference, sound, sort = TRUE) %>% 
    filter(sound != "") ->
    botlikh_data

botlikh_data %>% 
    bind_rows(zilo_data) %>% 
    group_by(reference) %>% 
    mutate(ratio = n/sum(n)) %>% 
    select(-n) %>% 
    spread(reference, ratio, fill = 0.1) %>% 
    mutate(difference_aa = sa - zilo,
           difference_sa = sa - zilo) ->
    merged_data
```

# Comparing [@saidovaabusov2012] and Zilo

```{r}
merged_data %>% 
  ggplot(aes(sa, zilo, label = sound, fill = difference_sa)) + 
  geom_abline(slope = 1, intercept = 0, linetype = 2)+
  geom_point()+
  ggrepel::geom_label_repel(size = 6, segment.color =  "black", segment.alpha = 0.5, color = "white", family = "Brill")+
  scale_fill_continuous(type = "viridis")+
  scale_y_log10()+
  scale_x_log10()+
  labs(y = "Number of utterances in Andi (log scale)",
       x = "Number of utterances in [Saidova, Abusov 2012] (log scale)")+
  theme(legend.title = element_blank())
```

# Comparing [@alekseev2019] and Zilo

```{r}
merged_data %>% 
  ggplot(aes(aa, zilo, label = sound, fill = difference_sa)) + 
  geom_abline(slope = 1, intercept = 0, linetype = 2)+
  geom_point()+
  ggrepel::geom_label_repel(size = 6, segment.color =  "black", segment.alpha = 0.5, color = "white", family = "Brill")+
  scale_fill_continuous(type = "viridis")+
  scale_y_log10()+
  scale_x_log10()+
  labs(y = "Number of utterances in Andi (log scale)",
       x = "Number of utterances in [Alekseev, Azaev 2019] (log scale)")+
  theme(legend.title = element_blank())
```

# Comparing Botlikh and Zilo: PCA analysis

```{r}
for_pca <- as.data.frame(merged_data[,2:4])
colnames(for_pca) <- c("[Alekseev, Azaev 2019]", "[Saidova, Abusov 2012]", "Zilo")
rownames(for_pca) <- merged_data$sound
PCA <- prcomp(for_pca, scale. = TRUE)

old_axes <- PCA$rotation
old_axes %>% 
  as_tibble() %>% 
  mutate(axis = rownames(PCA$rotation)) ->
  axes

merged_data %>% 
  bind_cols(as_tibble(PCA$x)) %>% 
  ggplot(aes(PC1, PC2))+
  geom_point(color = "black", alpha =  0.5)+
  ggrepel::geom_text_repel(aes(label = sound), size = 6, segment.color =  "black", segment.alpha = 0.5, family = "Brill", show.legend = FALSE) +
  geom_segment(data = axes, aes(xend = PC1, yend = PC2), x = 0, y = 0, color = "red", size = 2, arrow = arrow(length = unit(3, "mm")))+
  ggrepel::geom_label_repel(data = axes, aes(label = axis), color = "red", size = 6, alpha = 0.7)+
  labs(x = str_c("PC1 (", round(summary(PCA)$importance[2]*100), "%)"),
       y = str_c("PC2 (", round(summary(PCA)$importance[5]*100), "%)"))
```

# Comparing Botlikh and Zilo: PCA analysis

```{r}
merged_data %>% 
  bind_cols(as_tibble(PCA$x)) %>% 
  ggplot(aes(PC1, PC2))+
  geom_point(color = "black", alpha =  0.5)+
  ggrepel::geom_label_repel(aes(label = sound, fill = difference_aa), size = 6, segment.color =  "black", color = "white", segment.alpha = 0.5, family = "Brill", show.legend = FALSE) +
  geom_segment(data = axes, aes(xend = PC1, yend = PC2), x = 0, y = 0, color = "red", size = 2, arrow = arrow(length = unit(3, "mm")))+
  ggrepel::geom_label_repel(data = axes, aes(label = axis), color = "red", size = 6, alpha = 0.7)+
  labs(x = str_c("PC1 (", round(summary(PCA)$importance[2]*100), "%)"),
       y = str_c("PC2 (", round(summary(PCA)$importance[5]*100), "%)"))+
  scale_fill_continuous(type = "viridis")
```

Lets color segments according difference between [aa] and Zilo

# Syllable structure: algorithm

\begin{forest}
[syllable, for tree={parent anchor=south, child anchor=north}
[onset [{[str}, tier = word]][rhyme [nucleus [e, tier = word]][coda [{ŋθ]}, tier = word]]]]]
\end{forest}

* analyse all onsets of initial syllables in corpus
* analyse all codas of final syllables in corpus
* generalize  obtained initials and codas into a syllable model
* check, whether this model describes all intervocal consonant clusters

# Syllable structure: results

```{r}
tibble(source = "zilo", 
       word = zilo_analyse$zilo_l) %>% 
  na.omit() ->
  zilo_2_merge

botlikh_analyse %>% 
  select(new_id, ipa_aa, ipa_sa) %>%
  pivot_longer(names_to = "source", values_to = "word", starts_with("ipa_")) %>%
  select(-new_id) %>% 
  bind_rows(zilo_2_merge) %>% 
  mutate(source = str_remove_all(source, "ipa_"),
         word = str_remove_all(word, "\\(|\\)"),
         word = str_remove_all(word, "`"),
         word = str_replace(word, "tʃI", "tʃ'"),
         word = str_replace(word, "s-s", "sː"),
         word = str_replace(word, "χ-χ", "χː"),
         word = str_replace(word, "ʃ-w", "ʃʷ"),
         word = str_replace(word, "χ-w", "χʷ")
         ) %>% # repaire qχ'ʷa`ntʃ(I)i
  mutate(initial = str_extract(word, "^.*?[ĩũaouie]"),
         initial_vowel = str_extract(initial, "[ĩũaouie]"),
         initial = str_remove(initial, "-?[ĩũaouie].*"),
         initial = ifelse(initial == "", "#", initial),
         final = str_extract(word, "[ĩũaouie][^ĩũaouie]*$"),
         final_vowel = str_extract(final, "[ĩũaouie]"),
         final = ifelse(str_detect(final, "-"), str_remove(final, "[ĩũaouie].*?-"), "#")) %>%
  separate(final, into = c("cons_1", "cons_2"), sep = "-") %>%
  mutate(cons_2 = ifelse(is.na(cons_2), "#", cons_2)) %>%
  select(source, word, initial, initial_vowel, final_vowel, cons_1, cons_2) ->
  visualise

visualise %>%
  count(source, final_vowel, cons_1, cons_2) %>%
  gather_set_data(2:4) %>%
  mutate(type = "coda") %>%
  select(source, final_vowel, id, x, y, n, type) %>%
  rename(vowel = final_vowel) ->
  finals

visualise %>%
        mutate(initial_vowel = "V",
               final_vowel = "V",
               initial = case_when(
                 initial == "#" ~ "#",
                 str_detect(initial, "[ljmnrw]") ~ "L",
                 TRUE ~ "C"),
               cons_1 = case_when(
                 cons_1 == "#" ~ "#",
                 str_detect(cons_1, "[ljmnrw]") ~ "L",
                 TRUE ~ "C"),
               cons_2 = case_when(
                 cons_2 == "#" ~ "#",
                 str_detect(cons_2, "[ljmnrw]") ~ "L",
                 TRUE ~ "C")) ->
        visualise_simplified

visualise_simplified %>%
        count(source, final_vowel, cons_1, cons_2) %>%
        gather_set_data(2:4) %>%
        mutate(type = "coda") %>%
        select(source, final_vowel, id, x, y, n, type) %>%
        rename(vowel = final_vowel) ->
        finals_simplified

visualise_simplified %>%
  count(source, initial, initial_vowel) %>%
  gather_set_data(2:3) %>%
  mutate(type = "onset") %>%
  select(source, initial_vowel, id, x, y, n, type) %>%
  mutate(id = id + max(finals$id)) %>%
  rename(vowel = initial_vowel) %>%
  bind_rows(finals_simplified) %>%
  mutate(type = factor(type, levels = c("onset", "coda")),
         x = factor(x, levels = c("initial", "initial_vowel", "final_vowel", "cons_1", "cons_2"))) %>%
  # mutate(x = ifelse(str_detect(x, "vowel"), "vowel", x)) %>%
  #mutate(y = fct_reorder(y, n, mean)) %>%
  ggplot(aes(x, id = id, split = y, value = n))+
  geom_parallel_sets(alpha = 0.2, axis.width = 0.5) +
  geom_parallel_sets_axes(axis.width = 0.5, color = "lightgrey", fill = "white") +
  geom_parallel_sets_labels(angle = 0, size = 5) +
  theme_no_axes()+
  facet_grid(source~type, scales = "free")+
  theme(legend.position = "bottom")+
  labs(caption = "C — obstruent, L — sonorant, V — vowel, # — syllable boundary")
```

# Known problems

* Frequency analysis is not a novel approach: you can find it in [@bloomfield33] and probably among other scholars
* Botlikh dictionaries were specially selected for shared meaning, the same procedure for the Andic dictionary was not done
* Botlikh dictionaries contain a lot of borrowings, this is not true for the Andic dictionary
* Lemmata are not the same as wordforms, so the model should be checked with the wordform material
* Lemmata can contain some affix that will shift all frequencies (e. g. INF, PL or =CL) for some types of phonological units
* It would be nice to compare the obtained models with the models built on corpora data, when/if it will be available

# Further work

* Now within this project we are adding other Avar-Andic languages (Avar, Godoberi, Karata, Tindi, Chamalal, Bagvalal, Axvax) \pause
* This approach could be typologically scaled:
    * it is possible to apply it to 329 dictionary lists from IDS
    * as a result you will get what is typical and what is rare in languages of the world \pause
* This approach is not restricted to one type of phonological units:
    * segments
    * syllables
    * sound alternations
    * phonotactic rules
    * ... \pause
* It is possible to apply known NLP technics: 
    * language attribution (< authorship attribution);
    * measure distance between languages and phonological units (< vector models from distributional semantics);
    * model could be extended with Markov Chains (what is probability of the sequence *p-a* in a languages of the world?)

# References {.allowframebreaks}

